<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
<!-- Google Analytics -->
<script type="text/javascript">
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-113086304-2', 'auto');
ga('send', 'pageview');

</script>
<!-- End Google Analytics -->


  
  <title>Dex Personal Website</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  
  
  
  <meta name="description" content="Programming, Technology, Algorithm">
<meta property="og:type" content="website">
<meta property="og:title" content="Dex Personal Website">
<meta property="og:url" content="http://dexdexinwang.github.io/DexWebSite/index.html">
<meta property="og:site_name" content="Dex Personal Website">
<meta property="og:description" content="Programming, Technology, Algorithm">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dex Personal Website">
<meta name="twitter:description" content="Programming, Technology, Algorithm">
  
    <link rel="alternate" href="/DexWebSite/atom.xml" title="Dex Personal Website" type="application/atom+xml">
  
  
    <link rel="icon" href="/DexWebSite/images/favicon.png">
  
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  <link rel="stylesheet" href="/DexWebSite/css/style.css">
  <link rel="stylesheet" href="/DexWebSite/css/highlight.css">
  <script>
  let antiquityStorage = window.sessionStorage.getItem('antiquitySessionStorage');
  if (antiquityStorage == '' || antiquityStorage == null) {
    var antiquityLoader = '<div id="loaderbox"><div class="loader"><div class="load-roll"><div class="load-top"></div><div class="load-right"></div><div class="load-bottom"></div></div></div></div>';
    document.write(antiquityLoader);
    document.body.style.overflow = 'hidden'
  }
  </script>
</head>
</html>
<body>
  <div id="fullpage" class="mobile-nav-left">
    
      <div id="wrapper" style="background-image: url(/DexWebSite/images/bg.jpg)" title="background">
    
    
      <header id="header">
  <div id="nav-toggle" class="nav-toggle"></div>
  <div class="head-box global-width">
    <nav class="nav-box nav-left">
      
        <a class="nav-item" href="/DexWebSite/" title>Home</a>
      
        <a class="nav-item" href="/DexWebSite/../PersonalWebSite/" title>Background</a>
      
    </nav>
  </div>
</header>
      <div id="middlecontent" title class="global-width sidebar-left">
        <section id="main">
  
    <article id="post-Design-Data-Intensive-Note-9" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/14/Design-Data-Intensive-Note-9/">Design Data-Intensive Note #9</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/14/Design-Data-Intensive-Note-9/" class="article-date">
  <time datetime="2020-10-15T03:12:00.000Z" itemprop="datePublished">2020-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/System-Design/">System Design</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="Consistency-and-Consensus"><a href="#Consistency-and-Consensus" class="headerlink" title="Consistency and Consensus"></a>Consistency and Consensus</h3>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Design-Data-Intensive-Note-8" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/14/Design-Data-Intensive-Note-8/">Design Data-Intensive Note #8</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/14/Design-Data-Intensive-Note-8/" class="article-date">
  <time datetime="2020-10-15T03:11:00.000Z" itemprop="datePublished">2020-10-14</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/System-Design/">System Design</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="The-Trouble-with-Distributed-Systems"><a href="#The-Trouble-with-Distributed-Systems" class="headerlink" title="The Trouble with Distributed Systems"></a>The Trouble with Distributed Systems</h3>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Untitled" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/12/Untitled/">Design Data-Intensive Note #7</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/12/Untitled/" class="article-date">
  <time datetime="2020-10-12T07:07:00.000Z" itemprop="datePublished">2020-10-12</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/System-Design/">System Design</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="Transactions"><a href="#Transactions" class="headerlink" title="Transactions"></a>Transactions</h3>
      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Design-Data-Intensive-Note-6" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-6/">Design Data-Intensive Note #6</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-6/" class="article-date">
  <time datetime="2020-10-12T03:37:00.000Z" itemprop="datePublished">2020-10-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/System-Design/">System Design</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="Partitioning"><a href="#Partitioning" class="headerlink" title="Partitioning"></a>Partitioning</h3><p><em>Paritions(sharding)</em> are defined in such a way that each piece of data belongs to exactly one partition. Thus, a large dataset can be distributed across many disks, and the query load can be distributed across many processors. The main reason for wanting to partition data is <strong>scalability</strong>. <br></p>
<p><strong>Paritioning Goal</strong>: <br><br>The goal with paritiioning is to spread the data and the query load evenly across nodes. If the paritioning is unfair, so that some partitions have more data or queries than others, it is called <strong>skewed</strong>. A parition with dispropotionately high load is called a <strong>hot spot</strong>. <br></p>
<h6 id="Even-Parition-Randomly"><a href="#Even-Parition-Randomly" class="headerlink" title="Even Parition Randomly"></a>Even Parition Randomly</h6><p>No, it has no idea to read a particular item that the system has no way of knowing which node it is on, so the system will query all nodes in parallel. <br></p>
<h6 id="Partitioning-by-Key-Range"><a href="#Partitioning-by-Key-Range" class="headerlink" title="Partitioning by Key Range"></a>Partitioning by Key Range</h6><p>It assign a continuous range of keys to each partition. WIthin each parition, the system can keep keys in sorted order. <br></p>
<p>Advantage <br></p>
<ul>
<li>That range scans are easy <br><br>Disadvantage <br></li>
<li>It is hard to distributed data evenly which cause risk of skew  or hot spot <br></li>
</ul>
<h6 id="Partitioning-by-Hash-Key"><a href="#Partitioning-by-Hash-Key" class="headerlink" title="Partitioning by Hash Key"></a>Partitioning by Hash Key</h6><p>Advantage <br></p>
<ul>
<li>No skew and hot spot <br><br>Disadvantage <br></li>
<li>It is hard to do range search <br></li>
</ul>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Design-Data-Intensive-Note-4" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-4/">Design Data-Intensive Note #4</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-4/" class="article-date">
  <time datetime="2020-10-12T03:33:00.000Z" itemprop="datePublished">2020-10-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/System-Design/">System Design</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="Encoding-and-Evolution"><a href="#Encoding-and-Evolution" class="headerlink" title="Encoding and Evolution"></a>Encoding and Evolution</h3><p><em>Evolvability</em> is one character of maintainability to build systems that make it easy to adapt to change.</p>
<p>Normal Changes for Applications:</p>
<ul>
<li>A new field or record type needs to be captured</li>
<li>Existing data needs to be presented in a new way.</li>
</ul>
<p>The relational database assume that all data in the database conforms to one schema. There is excatly one shcema in force at any one point in time.<br> </p>
<p>The documentation (schema-on-read) database does not enforce a schema, so the database can contain a mixture of older and newer data formats written at different time. <br></p>
<p>Noramally, the data format or schema changes will cause change to application code, but code changes often cannot happen instantaneously. <br></p>
<ul>
<li>With server-side aplications you may want to perform a <strong>Rolling Upgrade (Staged rollout)</strong>, deploying the new version to a few nodes at a time, checking whether the new version is running smoothly, and gradually working your way through all the nodes. This allows new version to be deployed without service downtime, and thus encourages more frequent releases and better evolvbility.</li>
<li>With client-side applications you are at the mercy of the users, who may not install the update for some time.</li>
</ul>
<p>This means that old and new versions of the code, and old and new data formats, may potentically all <em>coexist</em> in the system at the same time. In order to contianue running smoothly, we need to maintain compatibility in both directions.</p>
<ul>
<li>Barckward compatibility: Newer code can read data that was written by older code. Also, it could keep old code to read the old data.</li>
<li>Forward compatibility: Older code and read data that was written by newer code. It allows old code to ignore additions made by a new version of the code.</li>
</ul>
<h4 id="Formats-for-Encoding-Data"><a href="#Formats-for-Encoding-Data" class="headerlink" title="Formats for Encoding Data"></a>Formats for Encoding Data</h4><p>Data Representations in two ways:</p>
<ul>
<li>In memory, data is kept in objects, structs, lists, ayyars, hash tabels, trees, and so on. These data structures are optimized for efficient access and manipulation by the CPU.</li>
<li>When you want to write data to a file or send it over the network, you have to encode it as some kind of self-contianed sequence of bytes (JSON). Since a pointer wouldn’t make sense to any other process, this sequence-of-bytes representation looks quite differnt from the data structures that are noamlly used in memory.</li>
</ul>
<p>Thus, we need some kind of translation between the 2 representations. <br><br><strong>Encoding (Serialization)</strong>: The translation from the in-memory representation to byte sequence. <br><br><strong>Decoding</strong>: The translation from the byte sequence to in-memory representation.<br></p>
<p>Language–Specific Formats (Build-In Serilization) is bad performance: </p>
<ul>
<li>The encoding is tied to particular programming language, and readding the data in another language is very diffcult.</li>
<li>In order to restore data in the same object types, the decoding process needs to be able to instantiate arbitrary classes.</li>
<li>Versioning data is often an afterthought.</li>
<li>Efficiency is also often an afterthought.</li>
</ul>
<h4 id="JSON-XML-and-CSV"><a href="#JSON-XML-and-CSV" class="headerlink" title="JSON, XML and CSV"></a>JSON, XML and CSV</h4><p>Hence, the Encoding or Decoding process will focus on widely known and widely supported programming languages such as JSON and XML. </p>
<p>JSON, XML, and CSV are human-readable but still have subtle problems:</p>
<ul>
<li>XML and CSV cannot distinguish between a number or string. JSON does not distinguishes integers and floating-point numbers.</li>
<li>XML and JSON does not support binary strings which are sequences of bytes without a character encoding. </li>
<li>CSV does not have any shcema, so it is up to the application to define the meaning of each row and column. </li>
<li>JSON and XML are optimal to complicated scheme. Otherwise, it should to hardcode the appropriate encoding/decoding logic instead.</li>
</ul>
<p>There are multiple encoding ways:</p>
<ul>
<li>Binary encoding</li>
<li>Message pack</li>
<li>Thrift </li>
<li>Protocal Buffers</li>
<li>Avro</li>
</ul>
<p>Protocol Buffers, Thrift, and Avro are simpler to implement and simpler to use, they have grown to support a fairly wide range of programming languages. <br></p>
<h4 id="Dataflow-Through-Services-Rest-and-RPC"><a href="#Dataflow-Through-Services-Rest-and-RPC" class="headerlink" title="Dataflow Through Services: Rest and RPC"></a>Dataflow Through Services: Rest and RPC</h4><p>The most common arrangement is to have 2 roles: clients and servers. <br> </p>
<p>Cients (web browsers) make requests to web servers, making GET requests to download HTML, CSS, JavaScript images, etc.. and making POST requests to submit data to the server. <br></p>
<p>The API consists of a standardized set of protocols and data formats (HTTP, URLs, SSL/TLS, HTML, etc). <br></p>
<p><strong>Microservices Architecture (Service-Oriented Architecture)</strong>: a  server can itself be a client to another service. This approach is often used to decompose a large application into smaller services by area of functionality, such that one service makes a request to another when it requires some functionality or data from what other service. <br></p>
<p>A key design goal of a service-oriented/microservices architecture is to make the application easier to change the maintain by making services independently deployable and evolvable. <br></p>
<p><strong>Web Services</strong> <br><br>When HTTP is used as the underlying protocol for talking to the service, it is called a web service. However, it will cover more services. <br></p>
<p><strong>REST</strong> <br></p>
<p>Rest is not a protocal. It emphasizes simple data formats, using URLs for identifying resources and using HTTP features for cache control, authentication, and content type negotiation. It is often associated with microservices. <br></p>
<p>An API designed according to principles of REST is called <em>RESTful API</em>. <br></p>
<p><strong>SOAP</strong> <br></p>
<p><em>SOAP</em> is an XML-based protocol for making network API requests. Although it is most commonly used over HTTP, it aims to be independent from HTTP and avoids using most HTTP features. Instead, it comes with a sprawling and complex multitude of related standards. <br></p>
<p>The API of a SOAP web siervice is described using an XML-based language called the Web Services Description Language, or WSDL. WSDL enables code generation so that a client can access a remote service using local classes and method call. <br></p>
<p>Even though SOAP and its various extensions are ostensibly standardized, interoperability between different vendors’ implmentation often causes problems.</p>
<p><strong>PRC</strong></p>
<p>Remote Procedure Call (PRC) model tries to make a request to a remote network service look the same as calling a function or method in your programming language, within the same process.</p>
<p>Disadvantages:</p>
<ul>
<li>A network request is unpredictable. The request or response may be lost due to a network problem, or the remote machine may be slow or unavailable, and such problems are entirely outside of your control.</li>
<li>A network request has another possible outcome: it may return without a result, due to a time. </li>
<li>If it retries a failed network request without no response, the server may operate duplicated requests.</li>
<li>It cannot handle network latency.</li>
<li>The parameters could be objects which may be problem for larger objects.</li>
<li>It’s hard to translate between different programming languages.</li>
</ul>
<h4 id="Message-Passing-Dataflow"><a href="#Message-Passing-Dataflow" class="headerlink" title="Message-Passing Dataflow"></a>Message-Passing Dataflow</h4><p>In order to handle network problem to pass messages, a message broker is design to stores the message temporarily.</p>
<p>Advantages:</p>
<ul>
<li>It can act as a buffer if the recipient is unavailable or overladed, and thus improve system reliability.</li>
<li>It can automatically redliver messages to a process that has crashed, and thus prevent messages from being lost.</li>
<li>It avoids the sender needing to konw the IP address and port number of the recipient.</li>
<li>It allows one message to be sent to several recipients.</li>
<li>It logically decouples the sender from the recipient.</li>
</ul>
<p>A differece compared to RPC is that message-passing communication is usually one-way: a sender normally doesn’t expect to receive a reply to its messages. <br></p>
<p><strong>Brakers Impelmentation</strong></p>
<ul>
<li>One process sends a message to a named queue or topic</li>
<li>The broker ensure that message is delivered to one or more consumers of or subscribers to that queue or topic.</li>
</ul>
<p><em>Actor Model</em> is a programming model ofr concurrency in a single process. <br></p>
<p><em>Distributed Actor Frameworks</em>, this programming model is used to scale an application across multiple nodes. </p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Design-Data-Intensive-Note-5" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-5/">Design Data-Intensive Note #5</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-5/" class="article-date">
  <time datetime="2020-10-12T03:33:00.000Z" itemprop="datePublished">2020-10-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/System-Design/">System Design</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="Distributrion"><a href="#Distributrion" class="headerlink" title="Distributrion"></a>Distributrion</h3><p><strong>Why Distribution?</strong></p>
<ul>
<li>Scalability</li>
<li>Fault tolerance / high availability </li>
<li>Latency</li>
</ul>
<p><strong>Replication</strong><br>Keeping a copy of the same data on several different nodes, potentically in different locations.  Replication provides redundancy: if some nodes are unavailable, the data can still be served from the remaining nodes. Replication can also help improve performance.<br></p>
<p><strong>Partitioning</strong><br>Splitting a big database into smaller subsets call partitions so that different partitions can be assign to different nodes. <br></p>
<h3 id="Replication"><a href="#Replication" class="headerlink" title="Replication"></a>Replication</h3><p>Replication means keeping a copy of the same data on multiple machines that are connected via a network by 3 reasons: <br></p>
<ul>
<li>To keep data geographically close to your users. (reduce latency)</li>
<li>To allow the system to continue working even if some of its parts have failed (increase availability)</li>
<li>To scale out the number of machines that can serve read query. (increase scalability)</li>
</ul>
<p>The most difficulty in replication lies in handling changes to replicated data: <br></p>
<ul>
<li>Whether to use synchronous or asynchronous replication.</li>
<li>How to handle failed replicas.</li>
</ul>
<h3 id="Leaders-and-Followers"><a href="#Leaders-and-Followers" class="headerlink" title="Leaders and Followers"></a>Leaders and Followers</h3><p><strong>Leader-Based Replication</strong>:</p>
<ul>
<li>One of the replicas is desigated the <strong>leader</strong>. When clients want to write to the database, they must send their requests to the leader, which first writes the new data to its local storage.</li>
<li>The other replicas as known as <strong>followers</strong>. Whenever the leader writes new data to its local storage, it also sends the data change to all of its followers as part of a <strong>replication log</strong> or <strong>change stream</strong>. Each follower takes the log from the leader and updates its local copy of the database accordingly, by applying all writes in the same order as they were processed on the leader.</li>
<li>When a client wants to read from database, it can query either the leader or any of the followers. However, writes are only accepted on the leader.</li>
</ul>
<p><strong>Synchronous VS Asynchronous</strong>:</p>
<p><em>Synchronous</em>: the leader waits until follower has confirmed that it received the write before reporting success to the use, and before making the wirte visible to other clients. It guaranteed to have an up-to-date copy of the data that is consistent with the leader.<br></p>
<p><em>Asynchronous</em>: the leader sends the message, but doesn’t wait for a response from the follower. It has higher performance. <br></p>
<p><strong>Setting Up New Followers</strong></p>
<ul>
<li>Take a consistent snapshot of the leader’s database at some point in time.</li>
<li>Copy the snapshot to the new follower node.</li>
<li>The follower connects to the leader and requests all the data changes that have happened since the snapshot was taken.</li>
<li>When the follower has processed the backlog of data changes since the snapshot, we say it has caught up.</li>
</ul>
<p><strong>Handling Node Outages</strong></p>
<p><em>Follower Failure Process</em></p>
<ul>
<li>Each follower keeps a log of the data changes it has received from the leader.</li>
<li>If follower is failure, it could be stored by following its log.</li>
</ul>
<p><em>Leader failure Prcoess</em></p>
<ul>
<li>Detemining that the leader has failed.</li>
<li>Choosing a new leader.</li>
<li>Reconfiguring the system to use the new leader.</li>
</ul>
<p><em>Leader failure problems</em></p>
<ul>
<li>The new leader may receive conflict writes in the meantime. The most common solution is for the old leader’s unreplicated writes to simply be discarded.</li>
<li>Discarding writes is especailly dangerous if other storage systems outside of the database need to be coordinated with the database contents.</li>
<li>It could happen that 2 nodes both believe that they are the leader. This situation is called split brain and it is dangerous. </li>
<li>What is the right timeout before the leader is declared dead? </li>
</ul>
<h4 id="Implementation-of-Replication-Logs"><a href="#Implementation-of-Replication-Logs" class="headerlink" title="Implementation of Replication Logs"></a>Implementation of Replication Logs</h4><p><strong>Statement-Based Replication</strong>, the leader logs every write request that it executes and sends the statment log to its followers for every INSERT, UPDATE, OR DELETE statement.</p>
<p><em>Log Problem</em>:</p>
<ul>
<li>Nondeterministic functions (NOW() or RAND()) does not work well.</li>
<li>Statements use an autoincrementing column depends on existing data, it will affect different result in multiple concurrently executing transactions.</li>
<li>Statements that have side effects may result in different side effects occuring on each replica, unless the side effects are absolutely deterministic. </li>
</ul>
<p><strong>Write-Ahead Log Shipping</strong></p>
<p><strong>Logical (row-based) Log Replication</strong></p>
<p><strong>Trigger-based Replication</strong></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Design-Data-Intensive-Note-3" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-3/">Design Data-Intensive Note #3</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-3/" class="article-date">
  <time datetime="2020-10-12T02:13:00.000Z" itemprop="datePublished">2020-10-11</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/System-Design/">System Design</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="Storage-and-Retrieval"><a href="#Storage-and-Retrieval" class="headerlink" title="Storage and Retrieval"></a>Storage and Retrieval</h3><p>On the most fundamental level, a database needs to do two things: when you give it some data, it should store the data, and when you ask it again later, it should give the data back to you.</p>
<p><strong>In order to tune a storage engine to perform well on your kind of workload, you need to have a rough idea of what the storage engine is doing under the hood.</strong> <br></p>
<h3 id="Data-Structure"><a href="#Data-Structure" class="headerlink" title="Data Structure"></a>Data Structure</h3><p>Assume there is Get() and Set() functions to save and get values from database. <br></p>
<h4 id="Append"><a href="#Append" class="headerlink" title="Append"></a>Append</h4><p>Each Set() only append new updated values to the end of the file that corresponding to key value. It is very efficient. Many databases internally use a <strong>log</strong>, which is an append-only data file. <br></p>
<p><em>Log</em> is used in the more general sense: an append-only sequence of records. It doesn’t have to be human-readable; it might be binary and intended only for other programs to read. <br></p>
<p><em>How to avoid eventually running out of dist spack?</em> <br><br>A good solution is to break the log into segments of a certain size by closing a segment file when it reaches a certain size, and make subsequent writes to a new segment file. Then, we can perform compaction on these segments.<br></p>
<p>Compaction means throwing away duplicate keys in the log, and keeping only the most recent update for each key.<br></p>
<p>Implementations:</p>
<ul>
<li>File format: Binary format will be faster</li>
<li>Deleting records: Delete action will apeend a special delection record to the data file as <em>“tombstone”</em>. When log segments are merged, the tombstone tells the merging process to discard any previous values for the deleted key.</li>
<li>Crash recovery: in-memory hash maps will lost if database is restarted. They system will record by reading the entire segment file. It is painful to take a long time.</li>
<li>Partially written read: Use checksums to detecte and ignore corrupted parts</li>
<li>Concurrentcy contry: one writing thread, multiple reading threads.</li>
</ul>
<p><em>Why don’t you update the file in place, overwriting the old value with the new value?</em> <br></p>
<ul>
<li>Appending and segment merging are sequential write operations, which are generally much faster than random writes, especially on magnetic spinning-disk hard drives, To some extent sequential writes are also preferable on flash-based solid state drives(SSDs).</li>
<li>Concurrency and crash recovery are much simpler if segment files are append-only or immutable. </li>
<li>Merging old segments avoids the problem of data files getting fragmented over time.</li>
</ul>
<h4 id="Index"><a href="#Index" class="headerlink" title="Index"></a>Index</h4><p>In general, Get() method will search a value from the start record to the end record. O(n). Index could be used to reduce the cost.</p>
<p>An Index is an additional structure that is derived from the primary data. Index could be added or removed, it does not affect the contents of the database; it only affects the performance of queries. Well-chosen indexes speed up read queries, but every index slows down writes.<br></p>
<p><strong>Hash Indexes -&gt; SSTable -&gt; LSM-Trees</strong></p>
<p>Key-value stores are quite similar to the dictionary type which is usually implemented as a In-Memory hash map. (key, byte offset). <br></p>
<p>Limitations:</p>
<ul>
<li>Hashmap must fit in memory becuase of a lot of random access I/O.</li>
<li>Range queries are not efficient.</li>
</ul>
<p>The advantage of In-Memory hash map is Sorted String Table (SSTable). It sounds like SortMap in Java (red-blck trees or AVL trees). <br> </p>
<ul>
<li>Merging segments is simple and efficient, even if the files are bigger than available memory (it record hash range boundary).</li>
<li>In order to find a particular key in the file, you no longer need to keep an index of all the keys in memory.</li>
<li>Since read requests need to scan over several key-value pairs in the requested range anyway, it is possible to group thoes records into a block and compress it before writing it to disk.</li>
</ul>
<p><strong>B-Trees</strong></p>
<p>The most common type of index is B-Tree which breaks the database down into fixed-size blocks or pages, traditionally 4KB in size, and read or write one page at a time. <br></p>
<p>Each page can be identified using an address or location, which allows one page to refer to another – similar to a pointer, but on disk instead of in memory.<br></p>
<p>Structure: <br><br>One page is designated as the root of the B-tree; whenever you want to look up a key in the index, you start here. The page contains several keys and references to child pages. Each child is responsible for a continuous range of keys, and the keys between the references indicate where the boundaries between those ranges lie. <br></p>
<p>The number of references to child pages in one page of the B-tree is called the <em>branching factor</em>.<br></p>
<p>The B-Tree algorighm ensure the tree remins balanced: a B-tree with n keys always has a depth of O(logn).</p>
<p>It is very common to have secondary indexes to have multiple search keys.</p>
<p><strong>Comparing B-Trees and LSM-Trees</strong><br>LSM-trees are typically faster for writes, whereas B-trees are ghought to be faster for reads. Reads are typically slower on LSM-trees because they have to check several different data structures and SSTables at different stages of compaction.</p>
<h4 id="Transaction-Processing-or-Analytics"><a href="#Transaction-Processing-or-Analytics" class="headerlink" title="Transaction Processing or Analytics"></a>Transaction Processing or Analytics</h4><p>In the early days of business data processing, a write to the database typically corresponded to a commercial transaction.</p>
<p><em>Transaction processing</em> just means allowing clients to make low-latency reads and writes as opposed to batch processing jobs, which only run periodically.</p>
<p><em>Online Transaction Processing(OLTP)</em> refers interactive to look up a small number of records by some key, using an index.</p>
<p>-Online Analytic Process(OLAP)_ refers business analysts to query history data into reports that help the management of a company make better decision(business intelligence).</p>
<table><br><tr><th><center><strong>Property</strong></center></th><br>  <th><center><strong>Transaction Processing Systems (OLTP)</strong></center></th><br>  <th><center>Analytic systems (OLAP)</center></th><br></tr><br><tr><br>  <td>Main read pattern</td><br>  <td>Small number of records per query, fetched by key</td><br>  <td>Aggregate over large number of records</td><br></tr><br><tr><br>  <td>Main write pattern</td><br>  <td>Random-access, low-latency writes from user input</td><br>  <td>Bulk import (ETL) or event stream</td><br></tr><br><tr><br>  <td>Primarily used by</td><br>  <td>End user/customer, via web application</td><br>  <td>Internal analyst, for decision support</td><br></tr><br><tr><br>  <td>What data represents</td><br>  <td>Latest state of data (current point in time)</td><br>  <td>History of events that happened over time</td><br></tr><br><tr><br>  <td>Dataset size</td><br>  <td>Gigabytes to terabytes</td><br>  <td>Terabytes to petabytes</td><br></tr><br></table>

<p><strong>Data Warehousing</strong><br>A data warehouse, by contrast, is a separate database that analysts can query to their hearts’ content, without affecting OLTP operations. <br></p>
<p>The data warehouse contains a read-only copy of the data in all various OLTP system in the compnay. Data is extracted from OLTP databases, transformed into an analysis-friendly schema, cleaned up, and then loaded into the data warehouse. This process of getting data into the warehouse is known as <em>Extract-Transform-Load (ETL)</em>. <br></p>
<p>Normally, data warehouse are used in <em>Star</em> schema or <em>Snowflakes</em> schema. The center of the schema is so-called <em>fact</em> table that contains measure columns. Others tables are called <em>dimension</em> tables which represent who, what, where, when, how, and why of the event.<br></p>
<p><strong>Column-Oriented Storage</strong></p>
<p>In most OLTP databases, storage is laid out in row-oriented fashion: all values from row of table are stored next to each other.<br></p>
<p>The idea behind column-oriented storage is simple: don’t store all the values from one row together, but store all the values from each column together instead. <br></p>
<p><em>Sort Order in Column Storage</em> is not a big porlbem because it doesn’t necessarily matter in which order the rows are stored. It depends on the inserted time. <br></p>
<p><em>Writing to Column-Oriented Storage</em> have the downside of makeing writes more diffult becaue column-oriented will do read queries faster. A good solution is LSM-trees. All writes first go to an in-memory store, where they are added to a stored structure and prepared for writing to disk. It doesn’t matter whether the in-memory store is row-oriented or column-oriented. when enough writes have accumulated, they are merged with the column files on disk and writeen to new files in bulk. <br></p>
<p><strong>Aggreation</strong></p>
<p>Another aspect of data warehouse that is worth mentioning briefly is <em>materialized aggregates</em> such as: COUNT, SUM, AVG, MIN, or MAX. It can be wasteful to crunch through the raw data every time. A good solution is to cache some of the counts or cums that queries use most often : Data Cubes or Materialized Views. <br></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Design-Data-Intensive-Note-2" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/10/Design-Data-Intensive-Note-2/">Design Data-Intensive Note #2</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/10/Design-Data-Intensive-Note-2/" class="article-date">
  <time datetime="2020-10-11T04:10:00.000Z" itemprop="datePublished">2020-10-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/System-Design/">System Design</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="Chapter-2-A-Range-of-General-Pupose-Data-Models"><a href="#Chapter-2-A-Range-of-General-Pupose-Data-Models" class="headerlink" title="Chapter 2 -  A Range of General-Pupose Data Models"></a>Chapter 2 -  A Range of General-Pupose Data Models</h3><p>Data models will affect “How the software is written.” and “How we think about the problem that we are solving.”<br></p>
<p>Most applications are built byu layering one data model on top of another. For each layer, the key question is: <em>How is it represented in terms of the next-lower layer?</em> Each layer hides the complexity of the layers below it by providing a clean data modal. <br></p>
<h4 id="Relational-Model-SQL"><a href="#Relational-Model-SQL" class="headerlink" title="Relational Model - SQL"></a>Relational Model - SQL</h4><p>SQL, data is origanized into relations(tables) where each relation is an unordered collection of tuples(rows). The roots of relational databases lie in business data processing such as <em>transaction processing</em> and <em>batch processing</em>.<br></p>
<p><strong>Object-Relational Mismatch</strong></p>
<p>An awkward translation layer is required between the objects in the applciation code and the database model of tables, rows, and columns. The disconnect between the models is sometimes called an <strong>impedance mismatch</strong>.</p>
<p>E.g. Saving Resume Solutions:</p>
<ol>
<li><p>SQL requires normalization which ask more tables to save one resume such as positions or educations tables. <br></p>
</li>
<li><p>New SQL supports for structured dataypes and XML data, it allowed multi-valued data to be stored within a single row. <br></p>
</li>
<li><p>Encode jobs, education, and contact infor as a JSON or XML doument and store it on a text column in the database like documentation database.</p>
</li>
</ol>
<p>The JSON representation has better <em>locality</em> than the multi-table schema which may query multiple tabels to get data because of normalization(reduced duplicated data). In JSON, all the relevant infomraiton is in one place, and one query is sufficient, but more <em>duplicated human-meaningful information</em>.</p>
<h4 id="NoSQL"><a href="#NoSQL" class="headerlink" title="NoSQL"></a>NoSQL</h4><p>NoSQL(Not Only SQL) driving:</p>
<ul>
<li>A need for greater scalability than relational databases can easily achieve, including very large datasets or very high write throughput.</li>
<li>A widespread perfermance for free and open source software over commercial database products</li>
<li>Specialized query opertions that are not well supported by the relaional model</li>
<li>Frustraion with the restrictiveness of relational schemas, and desire for a more dynamic and expressive data modal.</li>
</ul>
<h4 id="Relational-Versus-Document-Databases"><a href="#Relational-Versus-Document-Databases" class="headerlink" title="Relational Versus Document Databases"></a>Relational Versus Document Databases</h4><p><strong>Document Data Model</strong></p>
<p>Normally, it is regarded as “schemaless” or “schema-on-read”. It is applicable for document-like structure such as a tree of One-To-Many relationships.</p>
<p> Advantages: </p>
<ul>
<li>Schema flexibility</li>
<li>Better performance due to locality </li>
<li>For some applications it is closer to the data structures used by the application</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>Cannot refer directly to a nested item within a document. (However, as long as documents are not too deeply nested, that is not usually a problem).</li>
<li>Poor support for joins to support Many-To-Many in document databases. (Some applications does not require join method).</li>
</ul>
<p><strong>Relational Data Model</strong></p>
<p>It is regarded as “schema-on-write”.</p>
<p>Advantages:</p>
<ul>
<li>Better support for joins.</li>
<li>Many-To-One and Many-To-Many relationships</li>
</ul>
<p>Disadvantages:</p>
<ul>
<li>impedance mismatch</li>
<li>less locality</li>
</ul>
<h4 id="MapReduce-Quering"><a href="#MapReduce-Quering" class="headerlink" title="MapReduce Quering"></a>MapReduce Quering</h4><p><em>MapReduce</em> is a programming model for processing large amounts of data in bulk across many machines. The logic of the query is expressed with snippets of code, which are called repeatedly by the processing framework. It is based on the map (collect) and reduce (fold or inject) functions that exists in many functional Programming languages.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">//SQL</span><br><span class="line">SELECT date_trunc(&apos;month&apos;, observation_timestamp) AS observation_month,</span><br><span class="line">sum(num_animals) AS total_animals</span><br><span class="line">FROM observations</span><br><span class="line">WHERE family = &apos;Sharks&apos;</span><br><span class="line">GROUP BY observation_month;</span><br></pre></td></tr></table></figure>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">//MongoDB</span><br><span class="line">db.observations.mapReduce(</span><br><span class="line">	function map() &#123;</span><br><span class="line">    	var year = this.observationTimestamp.getFullYear();</span><br><span class="line">        var month = this.observationTimestamp.getMonth()+1;</span><br><span class="line">        emit(year + &quot;-&quot; + month, this.numAnimals);</span><br><span class="line">    &#125;,</span><br><span class="line">    function reduce(key, values) &#123;</span><br><span class="line">    	return Array.sum(values);</span><br><span class="line">    &#125;,</span><br><span class="line">	&#123;</span><br><span class="line">    	query: &#123;family:&quot;Sharks&quot;&#125;,</span><br><span class="line">        out: &quot;monthlySharkReport&quot;</span><br><span class="line">    &#125;</span><br><span class="line">)</span><br></pre></td></tr></table></figure>
<h4 id="Graph-Like-Data-Models"><a href="#Graph-Like-Data-Models" class="headerlink" title="Graph-Like Data Models"></a>Graph-Like Data Models</h4><p>Graph Data Models are created for the case that Many-To-Many relations are very common, and the data is more complex. <br></p>
<p>A graph consists of two kinds of objects: vertices (nodes or entities) and edges (relationships or arcs).</p>
<p>E.g. <br> </p>
<ul>
<li>Social Graphs</li>
<li>The Web Graph</li>
<li>Road or Rail Networks</li>
</ul>
<p><strong>Property Graphs</strong></p>
<p>Each vertext consists of: </p>
<ul>
<li>A unique identifier</li>
<li>A set of outgoing edges</li>
<li>A set of incoming edges</li>
<li>A collection of properties (key-value paires)</li>
</ul>
<p>Each edge consists of:</p>
<ul>
<li>A unique identifier</li>
<li>The vertext at which the edge starts (the tail vertex).</li>
<li>The vertext at which the edge ends (the head vertex)</li>
<li>A label to describe the kind of relationship between the two vertices</li>
<li>A collection of properties (key-value pairs)</li>
</ul>
<h4 id="Summary"><a href="#Summary" class="headerlink" title="Summary"></a>Summary</h4><ol>
<li><p>Document databases target use cases where data comes in self–contained documents and relationships between one doument and another are rare.</p>
</li>
<li><p>Graph databases go in the opposite direction, targeting use cases where anything is potentially related to everything (Many-To-Many).</p>
</li>
</ol>
<p>Both of these are schemaless.</p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-Design-Data-Intensive-Applications" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/10/Design-Data-Intensive-Applications/">Design Data-Intensive Note #1</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/10/Design-Data-Intensive-Applications/" class="article-date">
  <time datetime="2020-10-10T23:36:00.000Z" itemprop="datePublished">2020-10-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/System-Design/">System Design</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="Design-Data-Intensive-Aapplications"><a href="#Design-Data-Intensive-Aapplications" class="headerlink" title="Design Data-Intensive Aapplications"></a><a href="https://www.oreilly.com/library/view/designing-data-intensive-applications/9781491903063/" target="_blank" rel="noopener">Design Data-Intensive Aapplications</a></h3><h5 id="Book-Goals"><a href="#Book-Goals" class="headerlink" title="Book Goals"></a>Book Goals</h5><ul>
<li>Learn how to make data systems scalable to support web or mobile apps with millions of users.</li>
<li>Make applications higly available and operationally robust.</li>
<li>Find ways of making systems easier to maintina in the long run, enven as they grow and as requirements and technologies change.</li>
<li>Know what goes on inside major websites and online services.</li>
</ul>
<h5 id="Chapter-1"><a href="#Chapter-1" class="headerlink" title="Chapter 1"></a>Chapter 1</h5><p>Chapter explors the Fundamentals: Reliable, Scalable, and Maintainable.</p>
<p>Many applications today are dat-intensive, as opposed to compute-intensive. Raw CPU power is rarely a limiting factor for these applications- bigger problems are usually the amount of data, the complexity of data, and the speed at which it is changing.</p>
<p>Data Intensive funcationality:</p>
<ul>
<li>Database: Store data so that they, or another application, can find it again later.</li>
<li>Caches: Remember the result of an expensive operation to speed up reads.</li>
<li>Search Indexes: Allow users to search data by keyword or filter in various ways.</li>
<li>Stream Processing: Send a message to another process, to be handled asynchronously</li>
<li>Batch Processing: Periodically crunch a large amount of accumulated data.</li>
</ul>
<h6 id="Reliability"><a href="#Reliability" class="headerlink" title="Reliability"></a>Reliability</h6><p>The System should continue to work correctly (performing the correct fucntion at the desired level of performance) even in the face of adversity （hardware or software faults, and even human error). <br></p>
<p><strong>Software Expections (working correctly, continueing to work correctly, even when things go wrong.)</strong> <br></p>
<ul>
<li>The application performs the function that the user expected.</li>
<li>It can tolerate the suer making mistakes or using the software in unexpected ways.</li>
<li>Its performance is good enough for the required use case, under the expected load and data volumn.</li>
<li>The system prevents any unauthorized access and abuse.</li>
</ul>
<p><em>Faults</em>, is usually defined as one component of the system deviating from its expectation.<br></p>
<p><em>Fault-tolerant</em>, systems anticipate faults and can cop with them, because of the limited budget, the systems can only handle certain types of faults.<br></p>
<p><em>Failure</em>, it is when the system as a whole stops providing the required service to the suer. It’s possible to reduce the probaility of a failure to 0, but not fault.<br></p>
<p><strong>Hardware Faults</strong></p>
<ul>
<li>Hard disks crash -&gt; RAID configuration</li>
<li>Power grid has a blackout -&gt; dual power supplies</li>
<li>RAM and CPU become faulty -&gt; hot-swappable RAM and CPU</li>
</ul>
<p><strong>Software Errors</strong></p>
<ul>
<li>A software bug that causes every instanceo f an pplication server to crash when given a particular bad input.</li>
<li>A runaway process that uses up some shared resource such as CPU, memory, disk, or network bandwidth.</li>
<li>A service that the system depends on that slows down, becomes unresponsive, or starts returning corruptecd resonses.</li>
<li>Cascading failures, where a small fault in one component triggers a fault in another component, which in turn triggers further faults.</li>
</ul>
<p>There is no quick solution to the problem of systematic faults in softwares:<br></p>
<ul>
<li>Carefully thinking about assumptions and interactions in the system</li>
<li>Thorough testing</li>
<li>Process isolation</li>
<li>Allowing processes to crash and restart</li>
<li>Measureing, monitoring, and analyzing system behavior in production.</li>
</ul>
<p><strong>Human Errors</strong></p>
<p>Congiruation errors by operators were the leading cause of errors. Even when they have the best intentions, humans are known to be unreliable. Some approaches should be considered to reduce human errors.</p>
<ul>
<li>Design a restrictive system in a way that minimizes opportunities for error.</li>
<li>Decouple the places where people make the most mistakes from the palces where they can cause failures.</li>
<li>Test thoroughly at all levels, from unit tests to whole-system integration tests and manual tests. Automated testing is widely used, well understood, and especially valuable for covering corner cases that rarely arise in normal operation. </li>
<li>Allow quick and easy recovery from human errors, to minimize the impact in the case of a failure.</li>
<li>Set up detailed and clear monitoring, such as performance metrices and error rates. In other engineering disciplines this is referred to as <strong>telemetry</strong>. </li>
<li>Implement good management practices and training</li>
</ul>
<h6 id="Scalability"><a href="#Scalability" class="headerlink" title="Scalability"></a>Scalability</h6><p>As the system grows (in data volume, traffice volume, or complexity), these should be reasonable ways of dealing with that growth.<br></p>
<p>Scalability is the term we use to describe a system’s ability to cope with increased load. Consider questions: “If the system grows in a particular way, what are our options for coping with the growth?” and “How can we add computing resources to handle the additional load?”</p>
<p><strong>Describing Load</strong> <br><br>Load can be described with a few numbers which we call load parameters: <br> </p>
<ul>
<li>Request per second to a web server</li>
<li>The ratio of reads to writes in a database.</li>
<li>The number of simultaneously active users in a chat room</li>
<li>The hit rate on a cache</li>
</ul>
<p><strong>Descreibing performance</strong> <br></p>
<ul>
<li>When you increase a load parameter and keep the system resources unchanged, how is the performance of your system affected?</li>
<li>WHen you increase a load parameter, how much do you need to increase the resources if you want to keep the performance unchanged? </li>
</ul>
<p>We need to think of response time not as a single number, but as a distribution of values that you can measure. It’s common to see the average response time of a service reported. (Strictly speaking, the term “average” doesn’t refer to any particular formular, but in practice it is usually understood as the arithmetic mean: given n values, andd up all the valuess, and divide by n.) <br></p>
<p>Usually, it is better to use percentiles which could find median (50th), the tail latencie for important users who has more data (99th), or the best one (1th). <br></p>
<p>Also, percentiles are often used in service level objective(SLOs)and service level agreements(SLAs), contracts that define the expected performance and availability of a service. <br></p>
<p>As a server can only process a small number of things in parallel, it only takes a small number of slow requests to hold up the processing of subsequent requests - an affect sometimes known as head-of-line blocking. Hence, it is important to <em>measure response time on the client side</em>.</p>
<p><strong>Approaches for Coping with Load</strong></p>
<p>Architecture</p>
<ul>
<li>Scaling up (vertical sacling, moving to a more powerful machine)</li>
<li>Scaling out (horizontal scaling, distributing the load across multiple smaller machines). </li>
</ul>
<p>In sum, several fairly powerful machines can still be simpler and cheaper than a large number of small Virtual machines. There is no such thing as a generic, one-size-fits-all scalable architecture. <br> </p>
<p>Some systems are elastic, meaning that they can automatically add computing<br>resources when they detect a load increase, whereas other systems are scaled manually.<br></p>
<h6 id="Maintainability"><a href="#Maintainability" class="headerlink" title="Maintainability"></a>Maintainability</h6><p>Over time, many different people will work on the system (engineering and operations, both maintaining current behavior and adapting the system to new use cases), and they should all be able to work on it _productively.<br></p>
<p>It is well known that the majority of the cost of software is not in its initial development, but in its ongoing maintenance. <br></p>
<ul>
<li>fix bugs</li>
<li>keeping its systems operational</li>
<li>investigating failures</li>
<li>adapting it to new platforms</li>
<li>modifying it for new use cases</li>
<li>repaying technical debt</li>
<li>adding new features</li>
</ul>
<p>Many people working on software systems dislike maintenance of “legacy systems” that could be avoided by 3 design principles: <br></p>
<p><strong>Operability</strong> <br><br>Make it easy for operations teams to keep the system running smootthly. <br></p>
<ul>
<li>Monitoring the health of the system and quickly restoring service if it goes into a bad state</li>
<li>Tracking down the cause of problems, such as system failures or degraded performance</li>
<li>Keeping software and platforms up to date, including security patches</li>
<li>Keeping tabs on how different systems affect each other, so that a problematic change can be avoided before it causes damage</li>
<li>Anticipating future problems and solving them before they occur</li>
<li>Establishing good practices and tools for deployment, configuration management, and more</li>
<li>performing complex maintenance tasks, such as moving an application from one platform to another</li>
<li>Maintaining the security of the system as configuration changes are made</li>
<li>Defining processes that make operations predictable and help keep the production envionment stable</li>
<li>Preserving the organization’s knowledge about the system, even as individual people come and go</li>
</ul>
<p>Good operability means making routine tasks easy, allowing the operations team to focus their efforts on high-value activities. Data systems can do various things to make routine tasks easy, including:</p>
<ul>
<li>Providing visibility into the runtime behavior and internals of the system, with good monitoring</li>
<li>Providing good support for automation and integration with standard tools</li>
<li>Avoiding dependency on individual machines (allowing machines to be taken<br>down for maintenance while the system as a whole continues running uninterrupted)</li>
<li>Providing good documentation and an easy-to-understand operational model (“If I do X, Y will happen”)</li>
<li>Providing good default behavior, but also giving administrators the freedom to<br>override defaults when needed</li>
<li>Self-healing where appropriate, but also giving administrators manual control<br>over the system state when needed</li>
<li>Exhibiting predictable behavior, minimizing surprises</li>
</ul>
<p><strong>Simplicity</strong> <br><br>Make it easy for new engineers to understand the system by removing as much as complexity as possible from the system. A software project mired in complexity is described as a big ball of mud. <br> </p>
<p>Making a system simpler does not necessarily mean reducing its functionality. it can also mean removing accidental complexity. <br></p>
<p><strong>Evolvability (extensibility, modifiability, plasticity)</strong><br><br>Make it easy for engineers to make changes to the system in the feature, adapting it for unanticipated use cases as requirements changes. <br></p>
<p>Agile working patterns provide a framework for adapting to change. The Agile community has also developed technical tools and patterns that are helpful when developing software in frequently changing environment, such as test-driven development (TDD) and refactoring.</p>
<h6 id="In-Sum"><a href="#In-Sum" class="headerlink" title="In Sum"></a>In Sum</h6><p>Reliability means making systems work correctly, even when faults occur. <br><br>Scalability means having strategies for keeping performance good, even when load<br>increases.<br><br>Maintainability has many facets, but in essence it’s about making life better for the engineering and operations teams who need to work with the system. <br></p>

      
    </div>
    
  </div>
  
  
</article>

  
    <article id="post-C-Lesson-6-Array" class="article global-container article-type-post" itemscope itemprop="blogPost">
  
    <header class="article-header">
      
  
    <h1 itemprop="name">
      <a class="article-title" href="/DexWebSite/2020/10/10/C-Lesson-6-Array/">Java Concurrency II</a>
    </h1>
  

    </header>
  
  <div class="article-meta">
    <a href="/DexWebSite/2020/10/10/C-Lesson-6-Array/" class="article-date">
  <time datetime="2020-10-10T18:33:00.000Z" itemprop="datePublished">2020-10-10</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/DexWebSite/categories/Java-Programming-Language/">Java Programming Language</a>
  </div>

    
  </div>
  

  <div class="article-inner">
    
    <div class="article-content article-content-cloud" itemprop="articleBody">
      
        <h3 id="Concurrency-Control-Base"><a href="#Concurrency-Control-Base" class="headerlink" title="Concurrency Control Base"></a>Concurrency Control Base</h3><h5 id="Data-Races"><a href="#Data-Races" class="headerlink" title="Data Races"></a>Data Races</h5><p>Data Races occure when two operations confilict with each other if they operate on the same memory location, and at least one of them is a write. Races are mostly treated as bugs in Java programs.</p>
<p>Data Race 3 Factors:</p>
<ul>
<li>More then one operations work on the same memory.</li>
<li>At lest one operation is a write </li>
<li>At lest two operations are concurrent.</li>
</ul>
<p>E.g.<br><figure class="highlight java"><figcaption><span>Data Race</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> sharedInt = <span class="number">1</span>;</span><br><span class="line"><span class="comment">//Thread1:</span></span><br><span class="line">sharedInt = <span class="number">3</span></span><br><span class="line"><span class="comment">//Thread2: </span></span><br><span class="line">sharedInt += <span class="number">1</span></span><br><span class="line"><span class="comment">//Cannot predit the value of sharedInt. </span></span><br></pre></td></tr></table></figure></p>
<h5 id="Synchronization-for-Concurrency-in-Java"><a href="#Synchronization-for-Concurrency-in-Java" class="headerlink" title="Synchronization for Concurrency in Java"></a>Synchronization for Concurrency in Java</h5><p><a href="https://en.wikipedia.org/wiki/Synchronization" target="_blank" rel="noopener">Synchronization</a> is defined as a coordination of events to operate a system in unison in Wiki. <br></p>
<p>In Java, Synchronization is used to impose orders on concurrent events by 4 normal ways. <br></p>
<ul>
<li>Locks (synchronized)</li>
<li>Wait/Notify (condition synchronization)</li>
<li>Volatile</li>
<li>Concurrent Data Structure</li>
</ul>
<h5 id="Locks"><a href="#Locks" class="headerlink" title="Locks"></a>Locks</h5><p>Before introducing locks, two principles should be shown to understand locks.</p>
<p><strong>Critical section</strong>, a part of a multi-process program / threads that could not be concurrently executed by more than one of the procecesses / threads.</p>
<p><strong>Mutual exclusion</strong> defines a scenario that no more than one concurrent process in their critical section at the same time.</p>
<p>E.g. A toilet (Shared Memory, Critical Section) that could accessed by one and only one person (process/thread) in below steps:<br></p>
<ol>
<li>Person In <br></li>
<li>Lock Door <br></li>
<li>Do Something<br></li>
<li>Unlock Door<br></li>
<li>Person Out<br></li>
</ol>
<h5 id="Lock-Implementation-1-Synchronized"><a href="#Lock-Implementation-1-Synchronized" class="headerlink" title="Lock Implementation 1 - Synchronized"></a>Lock Implementation 1 - Synchronized</h5><p>In Java, one way to implement the mutual exclusion is using ‘Synchronized’ keyword. <br><br>Synchronized on static/non-static methods: <br></p>
<ul>
<li>synchronized on non-static mehtod = synchronized(this)</li>
<li>static synchronized = synchronized(Counter.calss) </li>
<li>synchronized(this)!= synchronized(Counter.calss)</li>
</ul>
<figure class="highlight java"><figcaption><span>Mutal Exclusion Implementation</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MutualExclusionClass</span> </span>&#123;</span><br><span class="line">	<span class="class"><span class="keyword">class</span> <span class="title">Counter</span></span>&#123;</span><br><span class="line">		<span class="keyword">private</span> <span class="keyword">int</span> value;</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="title">Counter</span><span class="params">(<span class="keyword">int</span> value)</span> </span>&#123;</span><br><span class="line">			<span class="keyword">this</span>.value = value;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="comment">//Mutual exclusion for critical section. </span></span><br><span class="line">			<span class="keyword">synchronized</span>(<span class="keyword">this</span>) &#123; <span class="comment">//synchronized should be work for object.</span></span><br><span class="line">				value++;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//...</span></span><br><span class="line">			<span class="comment">//others are not locked.</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//Mutual exclusion for method. </span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">decrease</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			value--;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">return</span> value;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">StaticCounter</span></span>&#123;</span><br><span class="line">		<span class="keyword">private</span>  <span class="keyword">static</span> <span class="keyword">int</span> value;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">increase</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="comment">//Mutual exclusion for critical section. </span></span><br><span class="line">			<span class="keyword">synchronized</span>(Counter.class) &#123; <span class="comment">//synchronized should be work for static class.</span></span><br><span class="line">				value++;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="comment">//...</span></span><br><span class="line">			<span class="comment">//others are not locked.</span></span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="comment">//synchronize method means synchronize class</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">void</span> <span class="title">decrease</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">synchronized</span>(Counter.class) &#123;</span><br><span class="line">				value--;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		</span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">getCount</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">synchronized</span>(Counter.class) &#123;</span><br><span class="line">				<span class="keyword">return</span> value;</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line">	</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		<span class="comment">// TODO Auto-generated method stub</span></span><br><span class="line"></span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>However, the critical section could be a class, a function, or a section of code. It could describe the critical section as Coarse Granularity Lock (CGL) or Fine Granularity Lock (FGL). <br></p>
<p><strong>Conditions for Deadlock</strong>: <br></p>
<ul>
<li>Mutal Exclusion：At least one resource must be held in a non-shareable mode. Only one process can use the resource at any given instance of time. </li>
<li>Hold and Wait or Resource Holding: A process is currently holding at least one resource and requesting additional resources which are being held by another processes.</li>
<li>No Preemption: a resource can be released only voluntarily by the process holding it. </li>
<li>Circular Wait.</li>
</ul>
<p>E.g. </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">P1: 				P2:</span><br><span class="line">lock1.lock();		lock2.lock();</span><br><span class="line">lock2.lock()		lock1.lock();</span><br><span class="line">lock2.unlock();		lock1.unlock();</span><br><span class="line">lock1.unlock();		lock2.unlock();</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><figcaption><span>Create Lock</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Lock lock = <span class="keyword">new</span> ReentrantLock(); <span class="comment">// Default lock in all objects.</span></span><br><span class="line">   lock.lock();</span><br><span class="line">   <span class="keyword">try</span>&#123;</span><br><span class="line">   	<span class="comment">//access the resource protected by this lock.</span></span><br><span class="line">   &#125; <span class="keyword">finally</span>&#123;</span><br><span class="line">   	lock.unlock();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>
<p><strong>Live Lock</strong> will happen if each side is actively resolving the problem (back off and retry). <br></p>
<h5 id="Lock-Implementation-2-Atomicity-（Volatile）"><a href="#Lock-Implementation-2-Atomicity-（Volatile）" class="headerlink" title="Lock Implementation 2 - Atomicity （Volatile）"></a>Lock Implementation 2 - Atomicity （Volatile）</h5><p>The volatile keyword guarantees visibility (semantically, happens-before), much like acquiring and releasing a lock. </p>
<figure class="highlight java"><figcaption><span>Volatile Key</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VolatileExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">volatile</span> <span class="keyword">boolean</span> flag = <span class="keyword">false</span>; <span class="comment">// volatile will avoid infinity loop for Java compile to do</span></span><br><span class="line">													<span class="comment">// optimization.</span></span><br><span class="line"></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">MyRunnable</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">		<span class="meta">@Override</span></span><br><span class="line">		<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">			<span class="keyword">while</span> (!flag) &#123;</span><br><span class="line">				System.out.println(<span class="string">"The thread is running."</span>);</span><br><span class="line">			&#125;</span><br><span class="line">			System.out.println(<span class="string">"The thread is finished."</span>);</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Thread t = <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyRunnable());</span><br><span class="line">		t.start();</span><br><span class="line">		<span class="keyword">try</span> &#123;</span><br><span class="line">			t.sleep(<span class="number">3000</span>);</span><br><span class="line">		&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">			<span class="comment">// TODO Auto-generated catch block</span></span><br><span class="line">			e.printStackTrace();</span><br><span class="line">		&#125;</span><br><span class="line">		flag = <span class="keyword">true</span>; <span class="comment">// Will pass signal between threads and that will create alive locks.</span></span><br><span class="line">		System.out.println(<span class="string">"Main thread is finished."</span>);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="comment">/*</span></span><br><span class="line"><span class="comment">	 * Atomicity of value++ is not preserved! volatile int value = 0; thread 1:</span></span><br><span class="line"><span class="comment">	 * value++; // read * 10x slower, write * 70x slower</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * thread 2: value++;</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * value ==2 ?</span></span><br><span class="line"><span class="comment">	 * </span></span><br><span class="line"><span class="comment">	 * Because volatile can only guarantee single read/write operation is atomic.</span></span><br><span class="line"><span class="comment">	 * Bottom line: read only or write only use cases are fine. if there a</span></span><br><span class="line"><span class="comment">	 * read-then-update case, if you really need atomicity for value++, check</span></span><br><span class="line"><span class="comment">	 * AtomicInteger/AtomicLong classes. However, they are expensive. Use it only if</span></span><br><span class="line"><span class="comment">	 * you really know why you need it.</span></span><br><span class="line"><span class="comment">	 */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h5 id="Lock-Implementation-3-Condition-Synchronization"><a href="#Lock-Implementation-3-Condition-Synchronization" class="headerlink" title="Lock Implementation 3 - Condition Synchronization"></a>Lock Implementation 3 - Condition Synchronization</h5><p>Sometime, a thread locked a resource and require I/O from other processes or threads. Hence, the are 3 ways to handle locked resource.</p>
<ul>
<li>Keep wait (very low efficiency)</li>
<li>Periodic check and go ( better efficiency, but may delay, it depends on period)</li>
<li>Use a service and notification, it will send message when the required I/O comes. (high efficency, almost no delay)</li>
</ul>
<p>For notification mechanism:</p>
<ul>
<li>Allow threads to wait on a condition</li>
<li>Allow a thread satisfieds the condition to notify all waiting threads</li>
</ul>
<p>A condition variable basically is a container of threads that are waiting on a certain condition with 3 operations: </p>
<ul>
<li>wait()</li>
<li>notify()</li>
<li>notifyAll()</li>
</ul>
<p>E.g. Producer Consumer Problem with Queue<br></p>
<p>As a consumer, if the queue is empty, <em>Wait</em> for it to be not empty, then poll one element from resource queue. <br><br>As a Producer, if the queue is full, <em>Wait</em> for it to be not full, then offer one element to it. <br></p>
<p>Build a blocking queue, such that</p>
<ul>
<li>When the queue is empety, consumer() will wait until produce() provide one element.</li>
<li>When the queue is full, producer() will wait until consumer() release one element. </li>
</ul>
<p>Blocking Queue:<br>Mutual exclusive -&gt; use locks<br>Wait -&gt; condition syunchronization</p>
<p>Each Java Object is a Monitor.<br>Each Java Object provides two concurrency permises: one lock -&gt; synchnoized, one condition -&gt; wait()</p>
<p><em>Monitor</em>:<br>In short, there are two queues controlling the access to enter the room:</p>
<ol>
<li>lock queue, there is only one thread at a time from the queue can enter</li>
<li>wait queue, there is a queue for the condition provided, all the threads wait(), is in the queue, and wait for the notify() call to remove from the wait queue.</li>
</ol>
<figure class="highlight java"><figcaption><span>Condition Synchronization</span></figcaption><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Producer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	Q q;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Producer</span><span class="params">(Q q)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.q = q;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		q.put(<span class="number">0</span>);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">	Q q;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(Q q)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">super</span>();</span><br><span class="line">		<span class="keyword">this</span>.q = q;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Override</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		System.out.println(q.take());</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Q</span> </span>&#123;</span><br><span class="line">	<span class="keyword">private</span> Queue&lt;Integer&gt; q;</span><br><span class="line">	<span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">int</span> limit;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="title">Q</span><span class="params">(<span class="keyword">int</span> limit)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">this</span>.q = <span class="keyword">new</span> LinkedList&lt;&gt;();</span><br><span class="line">		<span class="keyword">this</span>.limit = limit;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(Integer ele)</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (q.size() == limit) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				wait();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">if</span> (q.size() == <span class="number">0</span>) &#123;</span><br><span class="line">			notifyAll();</span><br><span class="line">		&#125;</span><br><span class="line">		q.offer(ele);</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Integer <span class="title">take</span><span class="params">()</span> </span>&#123;</span><br><span class="line">		<span class="keyword">while</span> (q.size() == <span class="number">0</span>) &#123;</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				wait();</span><br><span class="line">			&#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">				e.printStackTrace();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line"></span><br><span class="line">		<span class="keyword">if</span> (q.size() == limit) &#123;</span><br><span class="line">			notifyAll();</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">return</span> q.poll();</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProducerAndConsumerExample</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">		Q q = <span class="keyword">new</span> Q(<span class="number">20</span>);</span><br><span class="line">		List&lt;Thread&gt; threads = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			threads.add(<span class="keyword">new</span> Thread(<span class="keyword">new</span> Producer(q)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">			threads.add(<span class="keyword">new</span> Thread(<span class="keyword">new</span> Consumer(q)));</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="keyword">for</span> (Thread t : threads) &#123;</span><br><span class="line">			t.start();</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

      
    </div>
    
  </div>
  
  
</article>

  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/DexWebSite/page/2/">2</a><a class="page-number" href="/DexWebSite/page/3/">3</a><a class="page-number" href="/DexWebSite/page/4/">4</a><a class="extend next" rel="next" href="/DexWebSite/page/2/">Next &raquo;</a>
  </nav>


</section>
        <aside id="sidebar">
  
    <div class="widget-box">
  <div class="avatar-box">
    <img class="avatar" src="/DexWebSite/images/dexphoto.jpg" title="personal image">
    <h3 class="avatar-name">
      
        Dexin Wang
      
    </h3>
  </div>
</div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/DexWebSite/categories/Algorithm/">Algorithm</a></li><li class="category-list-item"><a class="category-list-link" href="/DexWebSite/categories/Basic/">Basic</a></li><li class="category-list-item"><a class="category-list-link" href="/DexWebSite/categories/C-Programming-Language/">C# Programming Language</a></li><li class="category-list-item"><a class="category-list-link" href="/DexWebSite/categories/Interview/">Interview</a></li><li class="category-list-item"><a class="category-list-link" href="/DexWebSite/categories/Java-Programming-Language/">Java Programming Language</a></li><li class="category-list-item"><a class="category-list-link" href="/DexWebSite/categories/Kits/">Kits</a></li><li class="category-list-item"><a class="category-list-link" href="/DexWebSite/categories/Object-Oriented-Design/">Object-Oriented Design</a></li><li class="category-list-item"><a class="category-list-link" href="/DexWebSite/categories/React-Development/">React Development</a></li><li class="category-list-item"><a class="category-list-link" href="/DexWebSite/categories/System-Design/">System Design</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-box">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2020/10/">October 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2020/09/">September 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2020/06/">June 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2020/05/">May 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2020/04/">April 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2020/01/">January 2020</a></li><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2019/10/">October 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2019/09/">September 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2019/05/">May 2019</a></li><li class="archive-list-item"><a class="archive-list-link" href="/DexWebSite/archives/2019/03/">March 2019</a></li></ul>
    </div>
  </div>

  
    
  <div class="widget-box">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/DexWebSite/2020/10/14/Design-Data-Intensive-Note-9/">Design Data-Intensive Note #9</a>
          </li>
        
          <li>
            <a href="/DexWebSite/2020/10/14/Design-Data-Intensive-Note-8/">Design Data-Intensive Note #8</a>
          </li>
        
          <li>
            <a href="/DexWebSite/2020/10/12/Untitled/">Design Data-Intensive Note #7</a>
          </li>
        
          <li>
            <a href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-6/">Design Data-Intensive Note #6</a>
          </li>
        
          <li>
            <a href="/DexWebSite/2020/10/11/Design-Data-Intensive-Note-4/">Design Data-Intensive Note #4</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
      </div>
      <footer id="footer">
  <div class="foot-box global-width">
    &copy; 2020 Dexin Wang &nbsp;&nbsp;
    Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    &nbsp;|&nbsp;Theme <a href="https://github.com/DexDexinWang/hexo-dex">antiquity</a>
    <br>
    <script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span id="busuanzi_container_site_pv">You are the <span id="busuanzi_value_site_pv"></span> visitor</span>
  </div>
</footer>
      <script src="https://code.jquery.com/jquery-2.0.3.min.js"></script>
<script>
if (!window.jQuery) {
var script = document.createElement('script');
script.src = "/js/jquery-2.0.3.min.js";
document.body.write(script);
}
</script>

  <link rel="stylesheet" href="/DexWebSite/fancybox/jquery.fancybox.css">
  <script src="/DexWebSite/fancybox/jquery.fancybox.pack.js"></script>


<script src="/DexWebSite/js/script.js"></script>



    </div>
    <nav id="mobile-nav" class="mobile-nav-box">
  <div class="mobile-nav-img mobile-nav-top"></div>
  
    <a href="/DexWebSite/" class="mobile-nav-link">Home</a>
  
    <a href="/DexWebSite/../PersonalWebSite/" class="mobile-nav-link">Background</a>
  
  <div class="mobile-nav-img  mobile-nav-bottom"></div>
</nav>    
  </div>
</body>
</html>